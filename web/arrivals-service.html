
<!-- before the Polymer elements imports -->
<link rel="import" href="packages/polymer/polymer.html">

<!-- Dart core-elements/paper-elements use underscores not dashes in the file names -->
<link rel="import" href="packages/core_elements/core_ajax_dart.html">

<!-- Other links -->
<!-- <link rel="stylesheet" href="arrrrivals.css"> -->

<polymer-element name="arrivals-service" attributes="arrivals">
  <template>
    <style>
    :host {
      display: none;
    }
    </style>
  </template>
  <core-ajax-dart id="ajax"
    auto
    url="posts.json"
    handleAs="json"><!-- 
    on-core-response="{{arrivalsLoaded}}" -->
  </core-ajax-dart>
  <script type="application/dart">
    import 'dart:html';
    import 'package:polymer/polymer.dart';
    
    @CustomTag('arrivals-service')
    class ArrivalsService extends PolymerElement {
      /*@published var arrivals2;
      
      @published get arrivals => arrivals2;
      
      @published void set arrivals(var arrivals) {
          arrivals2 = arrivals;
      }*/
      
      @published ArrivalsService.created() : super.created() {
        print("created");
        

        var ajax = querySelector('#ajax');  //cannot access shadowRoot so core-ajax-dart needs to be outside of template.
        
        //arrivals = querySelector('arrivals');
        
        ajax.on["core-response"].listen((event) {
          var detail = event.detail;
          var response = detail['response'];
          print("core-response");
          print(response[0]);
          
          arrivals = response[0];
    
        });
      }
      
      /*void arrivalsLoaded(Event e, var detail, Node target) {
        print("arrivalsLoaded");
      }*/
    }

      
    void arrivalsLoaded(e, detail, node) {
      print("arrivalsLoaded2");
    }
      
    /*void main() {
      initPolymer().run(() {
        var ajax = querySelector('core-ajax-dart');
        
        var arrivals = querySelector('arrivals');
        
        ajax.on["core-response"].listen((event) {
          var detail = event.detail;
          var response = detail['response'];
          print("core-response");
          print(response[0]);
          
          arrivals = response[0];

        });
      });
    }*/
  </script>
</polymer-element>